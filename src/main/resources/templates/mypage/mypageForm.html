<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>mypage</title>
    <style>
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }

        .toggle-switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }
    </style>
	<script th:inline="javascript">
	   const cusId = /*[[${cusId}]]*/ 'null';
	</script>
	<script>
	    document.addEventListener("DOMContentLoaded", function() {
	        const toggleSwitch = document.querySelector("input[type='checkbox']");
	        const cusId = document.querySelector(".toggle-switch").getAttribute("data-cusid");
	
	        toggleSwitch.addEventListener("change", function() {
	            const isChecked = toggleSwitch.checked ? 1 : 0;
	
	            fetch('/updateAlarmAgree', {
	                method: 'POST',
	                headers: {
	                    'Content-Type': 'application/x-www-form-urlencoded'
	                },
	                body: `cusId=${cusId}&alarmAgree=${isChecked}`
	            })
	            .then(response => response.text())
	            .then(data => {
	                if (data === 'success') {
	                    alert('알림 서비스 설정이 업데이트되었습니다.');
	                } else {
	                    alert('업데이트에 실패했습니다.');
	                }
	            });
	        });
	    });
	</script>
    <script>
	    document.addEventListener("DOMContentLoaded", function() {
	        const deleteButtons = document.querySelectorAll(".delete-button");
	
	        deleteButtons.forEach(button => {
	            button.addEventListener("click", function() {
	                const locId = button.getAttribute("data-locid");
	
	                if (confirm("이 위치를 삭제하시겠습니까?")) {
	                    fetch('/deleteLocation', {
	                        method: 'POST',
	                        headers: {
	                            'Content-Type': 'application/x-www-form-urlencoded'
	                        },
	                        body: `locId=${locId}`
	                    })
	                    .then(response => response.text())
	                    .then(data => {
	                        if (data === 'success') {
	                            alert('위치가 삭제되었습니다.');
	                            location.reload(); // 페이지를 새로고침하여 변경 사항 반영
	                        } else {
	                            alert('삭제에 실패했습니다.');
	                        }
	                    });
	                }
	            });
	        });
	    });
    </script>

</head>
<body>
	<!-- 헤더를 외부 프래그먼트로부터 가져오기 -->
	<div th:replace="fragments/header :: siteHeader"></div>
	<main>
	<article>
		<h3>마이페이지</h3>
		<table border="1">
			<tr>
				<td>카카오 알림서비스 사용여부</td>
				<td>
					<label class="toggle-switch" th:attr="data-cusid=${cusId}">
					    <input type="checkbox" th:checked="${alarmAgree == 1}">
					    <span class="slider"></span>
					</label>
				</td>
			</tr>
			<tr>
				<td colspan="2"><a href='/login/newpw'>새 비밀번호 설정</a></td>
			</tr>
			<tr>
				<td colspan="2">로그아웃</td>
			</tr>
			<tr>
				<td colspan="2">탈퇴</td>
			</tr>
		</table>
	</article>
	<article>
		<h3>관심위치리스트</h3>
		<table border="1">
             <tr>
                 <th>위치별명</th>
                 <th>장치ID</th>
                 <th>등록일</th>
                 <th>위치</th>
                 <th>삭제</th>
             </tr>
             <tr th:each="location : ${locationList}">
                 <td th:text="${location.LOC_NICK}"></td>
                 <td th:text="${location.DEV_ID}"></td>
                 <td th:text="${#strings.substring(location.REG_DT, 0, 10)}"></td>
                 <td th:text="${location.RGN_NM}"></td>
                 <td>
                 	<button type="button" th:attr="data-locid=${location.LOC_ID}" class="delete-button">삭제하기</button>
                 </td>
             </tr>
         </table>
	</article>
	<article>
		<h3>관심위치 등록하기</h3>
		<form id="addLocationForm">
			<table border="1">
				<tr>
	                <td>위치별명</td>
	                <td><input type="text" name="locNick" required></td>
	            </tr>
	            <tr>
	                <td>장치ID</td>
	                <td><input type="text" name="devId" required></td>
	            </tr>
	            <tr>
	                <td>위치 ID</td>
	                <td><input type="text" name="rgnId" required></td>
	            </tr>
			</table>
	    	<button type="button" id="registerLocationButton">등록하기</button>
    	</form>
	</article>
	</main>
</body>
</html>